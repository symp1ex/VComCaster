# VComCaster
Данная утилита призванна решить проблему связи устройств, использующих драйвер usb virtual com (например 2D сканер штрих-кодов) и тяжёлого ПО (например кассовое ПО). Часто сканер, в приведённом примере, может отваливаться и после его переподключения, чтобы заново занять зависший порт, приходится перезапускать использующее его ПО, что может занимать много времени. Утилита сама переподключается к сканеру и сама способная его найти на новом com-порту, если он изменился. Кассовое ПО же слушает вирутальномы com-порт, который постоянен, не меняется и не зависает, что избавляет от необходимости перезапуска ПО.

Чтобы начать пользоваться:

1. На Win10-11 добавить папку в исключения защитника Windows. На Win7 может понадобиться установка обновления безопасности KB3063858.
2. Создать пару виртуальных com-портов. Я использую для этого программу com0com*. Программа бесплатна и имеет открытый исходный код.
3. Один из созданных вирутальных com-портов подключаем к нашему ПО вместо сканера.
4. Второй вирутальный порт указыаем в config.ini самой утилиты в параметр "output_port".
5. Физический порт сканера указываем в том же конфиге в параметр "input_port".
6. Если хотим, чтобы сканер при смене порта продолжал автоматически переподключаться, в параметр "device_id" вписываем "Путь к экземпляру устройства" из свойств сканера в диспетчере устройств Винды.** Для отключения функции, просто оставьте значение пустым.
7. Сохраняем конфиг и запускаем. (если уже запущена: щёлкнуть правой кнопкой по иконке в трее, нажать "стоп" и нажать "переподключиться")

*При установке com0com нужно поставить галочку напротив пункта "COM# <-> COM#" и снять напротив пункта "CNCA0 <-> CNCB0", если она стоит. Останется только зайти в диспетчер устройств и посмотреть номера созданных портов. С программой на этом всё.
Хотя... если в BIOS включена настройка "SecureBoot", то Винда будет ругаться на отсутствие подписи у драйверов наших виртуальных портов. Придётся либо выключить настройку, либо пытаться загружать систему без обязательной проверки подписи драйверов, либо использовать другую программу, драйвера которой будут нравиться Винде. Вроде существуют платные альтернативы. ¯\_(ツ)_/¯

**Поиск идёт по "Путь к экземпляру устройства" из свойств сканера в диспетчере устройств Винды, но не по полному значению, а по маске. От значения нужно откинуть последние 5-7 символов (т.к. они могут меняться, если поменялся номер порта). Параметр "amount_rm_char_id = 0" определяет сколько символов откидывать от "device_id" перед поиском. Можно оставить 0, но тогда придётся вручную убрать лишние 5-7 символов из пути к устройству.

Утилита игнорирует настройку суффиксов cr и lf на самом сканере. Т.е. если нужны, то придётся включать их в конфиге утилиты, на сканере можно не включать.

Параметром "timeout_clearcash = 1.5" определяется сколько в секундах могут жить данные в буфере, до того как будут прочитаны. Пока данные в буфере хранятся, без перезапуска утилиты порт освободить нереально, даже отключив сканер от ПК. У меня при тестах всё корректно передавалось при значении 0.01. В теории, на ооооооооооооооооооооооочень(ну вы поняли) медленном железе, 1.5 секунд может оказать мало и марка будет передаваться не полностью, в таком случае пробуйте увеличить это значение. Это только в теории, слабо представляю что такое вообще возможно. (но параметр всё равно вынесен в конфиг)

При первом запуске утилита не сможет сама найти сканер по "device_id", пока не будет нажата кнопка "переподключиться". Когда включен "autoreconnect", то утилита сделает это за вас. Если не используется "autoreconnect", порт устройства лучше сразу указывать вручную. Хотя лучше это делать в любом случае.)

В "окно терминала" полностью дублируются логи в реальном времени, при подключении и настройки нет необходимости смотреть лог-файл.

